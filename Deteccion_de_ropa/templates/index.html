<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Espejo Inteligente - MiraPe</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      :root {
        --cream: #faf7f2;
        --pastel-blue: #e6f3ff;
        --light-blue: #b8e6ff;
        --pale-gold: #e8d5b7;
        --gold-accent: #d4af37;
        --text-dark: #2c2c2c;
        --text-medium: #5a5a5a;
        --shadow: rgba(0, 0, 0, 0.1);
        --blue-accent: #7db8e8;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Inter", "Segoe UI", sans-serif;
        background: linear-gradient(
          135deg,
          var(--cream) 0%,
          var(--pastel-blue) 50%,
          var(--light-blue) 100%
        );
        min-height: 100vh;
        color: var(--text-dark);
        line-height: 1.6;
      }

      /* Header y navegación */
      .header {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        z-index: 1000;
        padding: 15px 20px;
        border-bottom: 1px solid rgba(216, 216, 216, 0.3);
        box-shadow: 0 2px 20px rgba(0, 0, 0, 0.05);
      }

      .header-content {
        display: flex;
        align-items: center;
        justify-content: space-between;
        max-width: 1400px;
        margin: 0 auto;
      }

      .menu-button {
        display: flex;
        align-items: center;
        gap: 10px;
        background: none;
        border: none;
        cursor: pointer;
        padding: 8px 12px;
        border-radius: 8px;
        transition: background-color 0.3s ease;
        color: var(--text-dark);
        font-size: 14px;
        font-weight: 500;
      }

      .menu-button:hover {
        background: var(--pastel-blue);
      }

      .hamburger {
        display: flex;
        flex-direction: column;
        gap: 3px;
        width: 20px;
        height: 20px;
      }

      .hamburger span {
        width: 100%;
        height: 2px;
        background: var(--text-dark);
        border-radius: 1px;
        transition: all 0.3s ease;
      }

      .hamburger.active span:nth-child(1) {
        transform: rotate(45deg) translate(6px, 6px);
      }

      .hamburger.active span:nth-child(2) {
        opacity: 0;
      }

      .hamburger.active span:nth-child(3) {
        transform: rotate(-45deg) translate(6px, -6px);
      }

      .app-title {
        font-size: 1.2rem;
        font-weight: 600;
        color: var(--text-dark);
        letter-spacing: -0.01em;
      }

      /* Sidebar navegación */
      .sidebar {
        position: fixed;
        top: 0;
        left: -300px;
        width: 300px;
        height: 100vh;
        background: white;
        box-shadow: 2px 0 20px rgba(0, 0, 0, 0.1);
        transition: left 0.3s ease;
        z-index: 999;
        padding-top: 80px;
      }

      .sidebar.active {
        left: 0;
      }

      .sidebar-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 998;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
      }

      .sidebar-overlay.active {
        opacity: 1;
        visibility: visible;
      }

      .nav-menu {
        list-style: none;
        padding: 0;
        margin: 0;
      }

      .nav-item {
        border-bottom: 1px solid var(--pastel-blue);
      }

      .nav-link {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 20px 25px;
        text-decoration: none;
        color: var(--text-dark);
        font-weight: 500;
        transition: all 0.3s ease;
        cursor: pointer;
      }

      .nav-link:hover {
        background: var(--pastel-blue);
        color: var(--text-dark);
      }

      .nav-link.active {
        background: var(--blue-accent);
        color: white;
        border-right: 4px solid var(--gold-accent);
      }

      .nav-icon {
        font-size: 18px;
        width: 20px;
        text-align: center;
      }

      /* Ajustar el contenido principal */
      .main-content {
        margin-top: 80px;
        min-height: calc(100vh - 80px);
      }

      .view {
        display: none;
      }

      .view.active {
        display: block;
      }

      .mirror-container {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 30px;
        height: 100vh;
        padding: 20px;
      }

      .camera-panel {
        background: white;
        border-radius: 24px;
        padding: 40px;
        box-shadow: 0 20px 60px var(--shadow);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        position: relative;
        overflow: hidden;
      }

      .camera-panel::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(
          90deg,
          var(--pale-gold),
          var(--gold-accent),
          var(--pale-gold)
        );
      }

      .results-panel {
        background: white;
        border-radius: 24px;
        padding: 30px;
        box-shadow: 0 20px 60px var(--shadow);
        overflow-y: auto;
        position: relative;
      }

      .results-panel::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(
          90deg,
          var(--pastel-blue),
          var(--blue-accent),
          var(--pastel-blue)
        );
      }

      h1 {
        font-size: 2.2rem;
        font-weight: 300;
        color: var(--text-dark);
        margin-bottom: 40px;
        text-align: center;
        letter-spacing: -0.02em;
      }

      .video-container {
        width: 100%;
        max-width: 600px;
        height: 400px;
        position: relative;
        margin: 20px 0;
      }

      #video {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border: 2px solid var(--pale-gold);
        border-radius: 16px;
        background: #000;
        display: none;
        box-shadow: 0 15px 35px var(--shadow);
      }

      .camera-placeholder {
        width: 100%;
        height: 100%;
        border: 2px dashed var(--pale-gold);
        border-radius: 16px;
        background: var(--cream);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.1rem;
        color: var(--text-medium);
        font-weight: 300;
        position: absolute;
        top: 0;
        left: 0;
      }
      .controls {
        margin: 30px 0;
        display: flex;
        gap: 16px;
        justify-content: center;
        flex-wrap: wrap;
      }

      button {
        padding: 14px 28px;
        font-size: 14px;
        font-weight: 500;
        border: none;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.3s ease;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        box-shadow: 0 4px 12px var(--shadow);
        font-family: inherit;
      }

      .btn-primary {
        background: linear-gradient(
          135deg,
          var(--pale-gold),
          var(--gold-accent)
        );
        color: white;
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(212, 175, 55, 0.3);
      }

      .btn-danger {
        background: linear-gradient(135deg, #e8b4b8, #d4a5a8);
        color: white;
      }

      .btn-danger:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(232, 180, 184, 0.3);
      }

      .btn-warning {
        background: linear-gradient(135deg, var(--pastel-pink), #e8c4c8);
        color: var(--text-dark);
      }

      .btn-warning:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(244, 230, 231, 0.3);
      }

      button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
        box-shadow: 0 2px 8px var(--shadow);
      }

      .btn-photo {
        background: linear-gradient(135deg, #ff6b6b, #ff8e53) !important;
        color: white !important;
        padding: 16px 32px !important;
        font-size: 15px !important;
        font-weight: 600 !important;
        box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4) !important;
        border: 2px solid rgba(255, 255, 255, 0.2) !important;
        position: relative;
        overflow: hidden;
      }

      .btn-photo::before {
        content: "";
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: linear-gradient(
          45deg,
          transparent,
          rgba(255, 255, 255, 0.3),
          transparent
        );
        transform: rotate(45deg);
        transition: all 0.6s;
        opacity: 0;
      }

      .btn-photo:hover:not(:disabled)::before {
        opacity: 1;
        transform: rotate(45deg) translate(100%, 100%);
      }

      .btn-photo:hover:not(:disabled) {
        transform: translateY(-2px) scale(1.05);
        box-shadow: 0 8px 25px rgba(255, 107, 107, 0.5);
        background: linear-gradient(135deg, #ff5252, #ff7043) !important;
      }

      .btn-photo:active:not(:disabled) {
        transform: translateY(0) scale(1.02);
      }

      .upload-section {
        text-align: center;
        margin: 30px 0;
        padding: 24px;
        border: 2px dashed var(--blue-accent);
        border-radius: 16px;
        background: var(--pastel-blue);
      }

      .upload-section h3 {
        font-size: 1.1rem;
        font-weight: 400;
        color: var(--text-dark);
        margin-bottom: 16px;
      }

      .file-input {
        margin: 16px 0;
      }

      input[type="file"] {
        padding: 12px;
        border: 2px solid var(--pale-gold);
        border-radius: 8px;
        font-size: 14px;
        background: white;
        color: var(--text-dark);
        width: 100%;
        max-width: 300px;
        font-family: inherit;
      }

      input[type="file"]::file-selector-button {
        background: var(--pale-gold);
        border: none;
        color: var(--text-dark);
        padding: 8px 16px;
        border-radius: 6px;
        margin-right: 12px;
        cursor: pointer;
        font-weight: 500;
      }

      .status {
        margin: 20px 0;
        padding: 16px 24px;
        border-radius: 12px;
        text-align: center;
        font-weight: 500;
        font-size: 14px;
        display: none;
        border: 1px solid;
      }

      .status.success {
        background: #f0f9f0;
        color: #2d5a2d;
        border-color: var(--pale-gold);
      }

      .status.error {
        background: #fdf2f2;
        color: #a53e3e;
        border-color: #e8b4b8;
      }

      .status.info {
        background: var(--pastel-blue);
        color: var(--text-dark);
        border-color: var(--blue-accent);
      }

      .results h3 {
        margin-bottom: 24px;
        font-size: 1.4rem;
        font-weight: 400;
        text-align: center;
        color: var(--text-dark);
      }

      .stats-bar {
        background: var(--cream);
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 24px;
        border: 1px solid var(--pale-gold);
      }

      .stats-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
      }

      .stats-item:last-child {
        margin-bottom: 0;
      }

      .stats-label {
        font-size: 14px;
        color: var(--text-medium);
        font-weight: 500;
      }

      .stats-value {
        font-size: 18px;
        font-weight: 600;
        color: var(--text-dark);
      }

      .detected-items {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 16px;
        margin-top: 20px;
      }

      .item-card {
        background: white;
        border-radius: 16px;
        padding: 20px;
        text-align: center;
        box-shadow: 0 8px 25px var(--shadow);
        border: 1px solid #f5f5f5;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .item-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(
          90deg,
          var(--pale-gold),
          var(--gold-accent)
        );
      }

      .item-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 12px 35px rgba(0, 0, 0, 0.15);
      }

      .item-card img {
        width: 100%;
        height: 140px;
        object-fit: cover;
        border-radius: 12px;
        margin-bottom: 16px;
        border: 1px solid #f0f0f0;
      }

      .item-card h4 {
        margin: 12px 0;
        font-size: 1.1rem;
        font-weight: 600;
        text-transform: capitalize;
        color: var(--text-dark);
      }

      .color-preview {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        margin: 16px auto;
        border: 3px solid var(--pale-gold);
        box-shadow: 0 4px 15px var(--shadow);
      }

      .item-details {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .detail-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 13px;
      }

      .detail-label {
        color: var(--text-medium);
        font-weight: 500;
      }

      .detail-value {
        color: var(--text-dark);
        font-weight: 600;
      }

      .original-image-container {
        margin-bottom: 30px;
        text-align: center;
      }

      .original-image-wrapper {
        background: linear-gradient(135deg, var(--cream) 0%, #f8f4f1 100%);
        border-radius: 16px;
        padding: 20px;
        margin: 15px 0;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
        border: 1px solid var(--pale-gold);
      }

      .original-image-wrapper img {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }

      .original-image-wrapper img:hover {
        transform: scale(1.02);
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
      }

      .confidence-bar {
        width: 100%;
        height: 6px;
        background: #f0f0f0;
        border-radius: 3px;
        overflow: hidden;
        margin: 8px 0;
      }

      .confidence-fill {
        height: 100%;
        background: linear-gradient(
          90deg,
          var(--pale-gold),
          var(--gold-accent)
        );
        border-radius: 3px;
        transition: width 0.3s ease;
      }

      /* Estilos para las vistas */
      .view-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 40px 20px;
      }

      .view-header {
        text-align: center;
        margin-bottom: 50px;
      }

      .view-header h1 {
        font-size: 2.5rem;
        font-weight: 300;
        color: var(--text-dark);
        margin-bottom: 15px;
        letter-spacing: -0.02em;
      }

      .view-header h1 i {
        margin-right: 15px;
        color: var(--blue-accent);
      }

      .view-header p {
        font-size: 1.1rem;
        color: var(--text-medium);
        font-weight: 300;
      }

      .view-content {
        background: white;
        border-radius: 24px;
        padding: 60px 40px;
        box-shadow: 0 20px 60px var(--shadow);
        position: relative;
        overflow: hidden;
      }

      .view-content::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(
          90deg,
          var(--pastel-blue),
          var(--blue-accent),
          var(--pastel-blue)
        );
      }

      .feature-placeholder {
        text-align: center;
        padding: 40px 20px;
      }

      .feature-icon {
        font-size: 4rem;
        color: var(--blue-accent);
        margin-bottom: 20px;
        opacity: 0.7;
      }

      .feature-placeholder h3 {
        font-size: 1.8rem;
        font-weight: 500;
        color: var(--text-dark);
        margin-bottom: 15px;
      }

      .feature-placeholder p {
        font-size: 1.1rem;
        color: var(--text-medium);
        font-weight: 300;
        max-width: 500px;
        margin: 0 auto;
        line-height: 1.6;
      }

      @media (max-width: 1200px) {
        .video-container {
          max-width: 500px;
          height: 350px;
        }
      }

      @media (max-width: 1024px) {
        .mirror-container {
          grid-template-columns: 1fr;
          grid-template-rows: auto 1fr;
          height: auto;
        }

        .video-container {
          max-width: 480px;
          height: 320px;
        }

        h1 {
          font-size: 1.8rem;
        }

        button {
          padding: 12px 20px;
          font-size: 13px;
        }

        .detected-items {
          grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        }
      }

      @media (max-width: 768px) {
        .mirror-container {
          padding: 15px;
          gap: 20px;
        }

        .camera-panel,
        .results-panel {
          padding: 20px;
        }

        .video-container {
          max-width: 100%;
          height: 280px;
        }

        .controls {
          gap: 12px;
          flex-direction: row;
          flex-wrap: wrap;
        }

        .controls button {
          flex: 1;
          min-width: 140px;
          max-width: 180px;
          padding: 12px 16px;
          font-size: 13px;
        }

        .btn-photo {
          padding: 14px 20px !important;
          font-size: 14px !important;
        }

        .detected-items {
          grid-template-columns: 1fr;
        }

        h1 {
          font-size: 1.6rem;
        }
      }

      @media (max-width: 480px) {
        .mirror-container {
          padding: 10px;
          gap: 15px;
        }

        .camera-panel,
        .results-panel {
          padding: 15px;
        }

        .video-container {
          height: 240px;
        }

        button {
          padding: 10px 16px;
          font-size: 12px;
        }

        .controls {
          flex-direction: column;
          gap: 12px;
        }

        .controls button {
          width: 100%;
          max-width: 280px;
          padding: 12px 20px;
          font-size: 13px;
        }

        .btn-photo {
          padding: 14px 24px !important;
          font-size: 14px !important;
        }

        .controls button i {
          font-size: 11px !important;
          margin-right: 5px !important;
        }

        .btn-photo i {
          font-size: 13px !important;
        }

        h1 {
          font-size: 1.4rem;
          margin-bottom: 20px;
        }

        .upload-section {
          padding: 16px;
        }

        .upload-section h3 {
          font-size: 1rem;
        }

        /* Header responsive */
        .header {
          padding: 10px 15px;
        }

        .menu-button {
          padding: 6px 10px;
          font-size: 12px;
        }

        .hamburger {
          width: 18px;
          height: 18px;
        }

        .app-title {
          font-size: 1rem;
        }

        /* Sidebar responsive */
        .sidebar {
          width: 280px;
          left: -280px;
        }

        /* Vistas responsive */
        .view-container {
          padding: 20px 15px;
        }

        .view-header h1 {
          font-size: 2rem;
        }

        .view-header h1 i {
          margin-right: 10px;
        }

        .view-header p {
          font-size: 1rem;
        }

        .view-content {
          padding: 40px 20px;
        }

        .feature-icon {
          font-size: 3rem;
        }

        .feature-placeholder h3 {
          font-size: 1.5rem;
        }

        .feature-placeholder p {
          font-size: 1rem;
        }
      }
    </style>
  </head>
  <body>
    <!-- Header -->
    <header class="header">
      <div class="header-content">
        <button class="menu-button" id="menuToggle">
          <div class="hamburger">
            <span></span>
            <span></span>
            <span></span>
          </div>
          <span>Menú</span>
        </button>
        <div></div>
        <!-- Espaciador para centrar el título -->
      </div>
    </header>

    <!-- Sidebar -->
    <nav class="sidebar" id="sidebar">
      <ul class="nav-menu">
        <li class="nav-item">
          <a class="nav-link active" data-view="smart-mirror">
            <i class="nav-icon fas fa-magic"></i>
            <span>Espejo Inteligente</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/wardrobe-view">
            <i class="nav-icon fas fa-tshirt"></i>
            <span>Mi Armario</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" data-view="outfits">
            <i class="nav-icon fas fa-palette"></i>
            <span>Combinaciones</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" data-view="calendar">
            <i class="nav-icon fas fa-calendar-alt"></i>
            <span>Agenda de Looks</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" data-view="community">
            <i class="nav-icon fas fa-users"></i>
            <span>Comunidad</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" data-view="settings">
            <i class="nav-icon fas fa-cog"></i>
            <span>Configuración</span>
          </a>
        </li>
      </ul>
    </nav>

    <!-- Overlay para cerrar sidebar -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- Contenido principal -->
    <main class="main-content">
      <!-- Vista: Espejo Inteligente -->
      <div class="view active" id="smart-mirror-view">
        <div class="mirror-container">
          <div class="camera-panel">
            <h1>Espejo Inteligente</h1>

            <div class="video-container">
              <div id="cameraPlaceholder" class="camera-placeholder">
                Presiona "Encender Cámara" para comenzar
              </div>
              <video id="video" autoplay></video>
            </div>

            <div class="controls">
              <button id="startCamera" class="btn-primary">
                <i
                  class="fas fa-play"
                  style="font-size: 12px; margin-right: 6px"
                ></i>
                Encender Cámara
              </button>
              <button id="takePhoto" class="btn-photo" disabled>
                <i
                  class="fas fa-camera"
                  style="font-size: 14px; margin-right: 6px"
                ></i>
                Tomar Foto
              </button>
              <button id="stopCamera" class="btn-danger" disabled>
                <i
                  class="fas fa-stop"
                  style="font-size: 12px; margin-right: 6px"
                ></i>
                Apagar Cámara
              </button>
            </div>

            <div class="upload-section">
              <h3>
                <i
                  class="fas fa-cloud-upload-alt"
                  style="
                    font-size: 16px;
                    margin-right: 8px;
                    color: var(--blue-accent);
                  "
                ></i>
                Subir imagen desde archivo
              </h3>
              <div class="file-input">
                <input type="file" id="fileInput" accept="image/*" />
                <button id="uploadFile" class="btn-primary">
                  <i
                    class="fas fa-image"
                    style="font-size: 12px; margin-right: 6px"
                  ></i>
                  Procesar Imagen
                </button>
              </div>
            </div>

            <div id="status" class="status"></div>
          </div>

          <div class="results-panel">
            <div class="results">
              <h3>
                <i
                  class="fas fa-search"
                  style="
                    font-size: 18px;
                    margin-right: 8px;
                    color: var(--gold-accent);
                  "
                ></i>
                Análisis de Vestimenta
              </h3>

              <div id="statsBar" class="stats-bar" style="display: none">
                <div class="stats-item">
                  <span class="stats-label">Prendas detectadas:</span>
                  <span class="stats-value" id="itemCount">0</span>
                </div>
                <div class="stats-item">
                  <span class="stats-label">Confianza promedio:</span>
                  <span class="stats-value" id="avgConfidence">0%</span>
                </div>
                <div class="stats-item">
                  <span class="stats-label">Tiempo de análisis:</span>
                  <span class="stats-value" id="analysisTime">-</span>
                </div>
              </div>

              <div id="detectedItems" class="detected-items">
                <p
                  style="
                    text-align: center;
                    color: var(--text-medium);
                    font-style: italic;
                  "
                >
                  Las prendas detectadas aparecerán aquí
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Vista: Mi Armario -->
      <div class="view" id="wardrobe-view">
        <div class="view-container">
          <div class="view-header">
            <h1><i class="fas fa-tshirt"></i> Mi Armario</h1>
            <p>Aquí podrás ver todas las prendas detectadas y organizadas</p>
          </div>
          <div class="view-content">
            <div class="feature-placeholder">
              <i class="fas fa-tshirt feature-icon"></i>
              <h3>Próximamente</h3>
              <p>
                Esta sección estará disponible pronto para gestionar tu armario
                virtual
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- Vista: Combinaciones -->
      <div class="view" id="outfits-view">
        <div class="view-container">
          <div class="view-header">
            <h1><i class="fas fa-palette"></i> Combinaciones</h1>
            <p>Crea y guarda combinaciones perfectas para cada ocasión</p>
          </div>
          <div class="view-content">
            <div class="feature-placeholder">
              <i class="fas fa-palette feature-icon"></i>
              <h3>Próximamente</h3>
              <p>
                Aquí podrás crear outfits personalizados y recibir sugerencias
                de estilo
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- Vista: Agenda de Looks -->
      <div class="view" id="calendar-view">
        <div class="view-container">
          <div class="view-header">
            <h1><i class="fas fa-calendar-alt"></i> Agenda de Looks</h1>
            <p>Planifica tus outfits para cada día de la semana</p>
          </div>
          <div class="view-content">
            <div class="feature-placeholder">
              <i class="fas fa-calendar-alt feature-icon"></i>
              <h3>Próximamente</h3>
              <p>
                Organiza tus looks semanales y nunca más repitas outfits sin
                querer
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- Vista: Comunidad -->
      <div class="view" id="community-view">
        <div class="view-container">
          <div class="view-header">
            <h1><i class="fas fa-users"></i> Comunidad</h1>
            <p>Conecta con otros usuarios y comparte tu estilo</p>
          </div>
          <div class="view-content">
            <div class="feature-placeholder">
              <i class="fas fa-users feature-icon"></i>
              <h3>Próximamente</h3>
              <p>
                Comparte tus looks favoritos y descubre tendencias de la
                comunidad
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- Vista: Configuración -->
      <div class="view" id="settings-view">
        <div class="view-container">
          <div class="view-header">
            <h1><i class="fas fa-cog"></i> Configuración</h1>
            <p>Personaliza tu experiencia en MiraPe</p>
          </div>
          <div class="view-content">
            <div class="feature-placeholder">
              <i class="fas fa-cog feature-icon"></i>
              <h3>Próximamente</h3>
              <p>
                Ajusta las preferencias de la aplicación según tus necesidades
              </p>
            </div>
          </div>
        </div>
      </div>
    </main>

    <script>
      const video = document.getElementById("video");
      const cameraPlaceholder = document.getElementById("cameraPlaceholder");
      const startCameraBtn = document.getElementById("startCamera");
      const stopCameraBtn = document.getElementById("stopCamera");
      const takePhotoBtn = document.getElementById("takePhoto");
      const fileInput = document.getElementById("fileInput");
      const uploadFileBtn = document.getElementById("uploadFile");
      const statusDiv = document.getElementById("status");
      const detectedItemsDiv = document.getElementById("detectedItems");
      const statsBar = document.getElementById("statsBar");
      const itemCount = document.getElementById("itemCount");
      const avgConfidence = document.getElementById("avgConfidence");
      const analysisTime = document.getElementById("analysisTime");

      // Variables para el menú de navegación
      const menuToggle = document.getElementById("menuToggle");
      const sidebar = document.getElementById("sidebar");
      const sidebarOverlay = document.getElementById("sidebarOverlay");
      const hamburger = menuToggle.querySelector(".hamburger");
      const navLinks = document.querySelectorAll(".nav-link");
      const views = document.querySelectorAll(".view");

      let stream = null;
      let startTime = null;

      // Funciones para el menú de navegación
      function toggleSidebar() {
        sidebar.classList.toggle("active");
        sidebarOverlay.classList.toggle("active");
        hamburger.classList.toggle("active");
      }

      function closeSidebar() {
        sidebar.classList.remove("active");
        sidebarOverlay.classList.remove("active");
        hamburger.classList.remove("active");
      }

      function showView(viewId) {
        // Ocultar todas las vistas
        views.forEach((view) => view.classList.remove("active"));

        // Mostrar la vista seleccionada
        const targetView = document.getElementById(viewId + "-view");
        if (targetView) {
          targetView.classList.add("active");
        }

        // Actualizar el estado activo del menú
        navLinks.forEach((link) => link.classList.remove("active"));
        const activeLink = document.querySelector(`[data-view="${viewId}"]`);
        if (activeLink) {
          activeLink.classList.add("active");
        }

        // Cerrar sidebar en móvil
        closeSidebar();
      }

      // Event listeners para el menú
      menuToggle.addEventListener("click", toggleSidebar);
      sidebarOverlay.addEventListener("click", closeSidebar);

      // Event listeners para los enlaces de navegación
      navLinks.forEach((link) => {
        link.addEventListener("click", (e) => {
          const viewId = link.getAttribute("data-view");
          const href = link.getAttribute("href");

          // Solo interceptar si tiene data-view y no tiene href para navegación externa
          if (viewId && (!href || href === "#")) {
            e.preventDefault();
            showView(viewId);
          }
          // Si tiene href (como /wardrobe-view), dejarlo navegar normalmente
        });
      });

      // Cerrar sidebar con tecla Escape
      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape") {
          closeSidebar();
        }
      });

      const filteredItems = [
        "leg warmer",
        "sleeve",
        "pocket",
        "neckline",
        "zipper",
        "bead",
        "bow",
        "rivet",
        "ruffle",
        "sequin",
        "tassel",
        "applique",
        "flower",
        "fringe",
        "lapel",
        "epaulette",
      ];

      function filterDetectedItems(items) {
        return items.filter(
          (item) =>
            !filteredItems.some((filtered) =>
              item.tipo.toLowerCase().includes(filtered.toLowerCase())
            )
        );
      }

      function showStatus(message, type = "info") {
        statusDiv.textContent = message;
        statusDiv.className = `status ${type}`;
        statusDiv.style.display = "block";

        setTimeout(() => {
          statusDiv.style.display = "none";
        }, 5000);
      }

      function confirmAction(message) {
        return confirm(message);
      }

      function updateStats(items, processingTime) {
        if (items.length > 0) {
          statsBar.style.display = "block";

          itemCount.textContent = items.length;

          const totalConfidence = items.reduce(
            (sum, item) => sum + item.score,
            0
          );
          const avgConf = ((totalConfidence / items.length) * 100).toFixed(1);
          avgConfidence.textContent = `${avgConf}%`;

          analysisTime.textContent = `${processingTime}ms`;
        } else {
          statsBar.style.display = "none";
        }
      }

      startCameraBtn.addEventListener("click", async () => {
        if (confirmAction("¿Deseas encender la cámara?")) {
          try {
            stream = await navigator.mediaDevices.getUserMedia({
              video: { width: 640, height: 480 },
            });
            video.srcObject = stream;
            video.style.display = "block";
            cameraPlaceholder.style.display = "none";

            startCameraBtn.disabled = true;
            stopCameraBtn.disabled = false;
            takePhotoBtn.disabled = false;

            showStatus("Cámara encendida correctamente", "success");
          } catch (error) {
            showStatus(
              "Error al acceder a la cámara: " + error.message,
              "error"
            );
          }
        }
      });

      stopCameraBtn.addEventListener("click", () => {
        if (stream) {
          stream.getTracks().forEach((track) => track.stop());
          video.srcObject = null;
          video.style.display = "none";
          cameraPlaceholder.style.display = "flex";
          stream = null;

          startCameraBtn.disabled = false;
          stopCameraBtn.disabled = true;
          takePhotoBtn.disabled = true;

          showStatus("Cámara apagada", "info");
        }
      });

      takePhotoBtn.addEventListener("click", () => {
        if (stream && confirmAction("¿Deseas tomar la foto?")) {
          startTime = Date.now();

          const canvas = document.createElement("canvas");
          canvas.width = video.videoWidth;
          canvas.height = video.videoHeight;

          const ctx = canvas.getContext("2d");
          ctx.drawImage(video, 0, 0);

          const dataURL = canvas.toDataURL("image/jpeg", 0.8);

          showStatus("Foto tomada. Analizando prendas...", "info");

          fetch("/upload", {
            method: "POST",
            headers: {
              "Content-Type": "application/x-www-form-urlencoded",
            },
            body: "image=" + encodeURIComponent(dataURL),
          })
            .then((response) => response.json())
            .then((data) => {
              const processingTime = Date.now() - startTime;

              if (data.error) {
                showStatus("Error: " + data.error, "error");
              } else {
                const filteredResults = filterDetectedItems(data.detected);
                showStatus("Análisis completado exitosamente", "success");
                displayResults(filteredResults, processingTime);
              }
            })
            .catch((error) => {
              showStatus(
                "Error al procesar la imagen: " + error.message,
                "error"
              );
            });
        }
      });

      uploadFileBtn.addEventListener("click", () => {
        const file = fileInput.files[0];
        if (!file) {
          showStatus("Por favor selecciona un archivo", "error");
          return;
        }

        if (confirmAction("¿Deseas subir esta imagen?")) {
          startTime = Date.now();

          const formData = new FormData();
          formData.append("file", file);

          showStatus("Subiendo imagen. Analizando prendas...", "info");

          fetch("/upload", {
            method: "POST",
            body: formData,
          })
            .then((response) => response.json())
            .then((data) => {
              const processingTime = Date.now() - startTime;

              if (data.error) {
                showStatus("Error: " + data.error, "error");
              } else {
                const filteredResults = filterDetectedItems(data.detected);
                showStatus("Análisis completado exitosamente", "success");
                displayResults(
                  filteredResults,
                  processingTime,
                  data.original_image
                );
              }
            })
            .catch((error) => {
              showStatus(
                "Error al procesar la imagen: " + error.message,
                "error"
              );
            });
        }
      });

      function displayResults(items, processingTime = 0, originalImage = null) {
        detectedItemsDiv.innerHTML = "";
        updateStats(items, processingTime);

        // Mostrar imagen original si existe
        if (originalImage) {
          const originalImageDiv = document.createElement("div");
          originalImageDiv.className = "original-image-container";
          originalImageDiv.innerHTML = `
            <h3 style="margin-bottom: 15px; color: var(--text-dark);">📸 Imagen Original</h3>
            <div class="original-image-wrapper">
              <img src="/${originalImage}" alt="Imagen original" style="
                max-width: 100%;
                max-height: 300px;
                border-radius: 12px;
                box-shadow: 0 4px 15px rgba(0,0,0,0.1);
                object-fit: contain;
                background: white;
              ">
            </div>
            <hr style="margin: 20px 0; border: none; height: 1px; background: linear-gradient(90deg, transparent, var(--blue-accent), transparent);">
          `;
          detectedItemsDiv.appendChild(originalImageDiv);
        }

        if (items.length === 0) {
          const noItemsDiv = document.createElement("div");
          noItemsDiv.innerHTML = `
            <p style="text-align: center; color: var(--text-medium); font-style: italic;">
              No se detectaron prendas relevantes en la imagen.
            </p>
          `;
          detectedItemsDiv.appendChild(noItemsDiv);
          return;
        }

        // Crear título para las prendas detectadas
        if (originalImage) {
          const detectedTitle = document.createElement("h3");
          detectedTitle.innerHTML = "👕 Prendas Detectadas";
          detectedTitle.style.marginBottom = "15px";
          detectedTitle.style.color = "var(--text-dark)";
          detectedItemsDiv.appendChild(detectedTitle);
        }

        items.forEach((item) => {
          const itemCard = document.createElement("div");
          itemCard.className = "item-card";

          const [r, g, b] = item.color_rgb;
          const confidence = (item.score * 100).toFixed(1);

          itemCard.innerHTML = `
            <img src="/${item.img_path}" alt="${item.tipo}" loading="lazy">
            <h4>${item.tipo}</h4>
            <div class="color-preview" style="background-color: rgb(${r}, ${g}, ${b})"></div>
            
            <div class="item-details">
              <div class="detail-row">
                <span class="detail-label">Color:</span>
                <span class="detail-value">${
                  item.color_name || "Sin nombre"
                }</span>
              </div>
              
              <div class="detail-row">
                <span class="detail-label">RGB:</span>
                <span class="detail-value">(${r}, ${g}, ${b})</span>
              </div>
              
              <div class="detail-row">
                <span class="detail-label">Confianza:</span>
                <span class="detail-value">${confidence}%</span>
              </div>
              
              <div class="confidence-bar">
                <div class="confidence-fill" style="width: ${confidence}%"></div>
              </div>
            </div>
          `;

          detectedItemsDiv.appendChild(itemCard);
        });
      }

      window.addEventListener("beforeunload", () => {
        if (stream) {
          stream.getTracks().forEach((track) => track.stop());
        }
      });
    </script>
  </body>
</html>
